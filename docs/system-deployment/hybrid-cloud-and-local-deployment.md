# 云端本地混合部署​

一个部署在局域网内的VC Hub节点可以和云端的VC Hub进行组网。局域网内的节点在没有公网IP的情况下，一般只能从局域网的节点创建出站连接，连接到云端的节点。

![alt text](4.png)

#### 隧道网络

当出站连接成功连接后，两个节点之间会建立一条隧道网络，通过这条隧道网络，局域网的节点和云端的节点可以实现双向访问，即使局域网的节点没有公网ip, 云端的节点还是能够通过隧道网络向局域网内的节点发送http请求并读写局域网节点的数据。

![alt text](5.png)



#### 流量控制

WAGO VC Hub组网的节点之间采集的数据不会进行实时同步，只有当云节点上的终端用户查看远程节点的数据时，云节点才会向局域网的节点发送数据请求，通过这种按需订阅的方式可以有效的避免在云平台上产生天价账单。

#### 注意事项

由于公网的网络环境比较复杂，组网的tcp连接可能无法访问云端节点，特别是防火墙的限制，所以配置云边的组网时需要注意以下几点：

1. 云环境的服务器尽量采用静态IP, 如果没有静态IP, 可以给服务器绑定一个域名。
2. 云平台的服务器一个默认只会开放http服务的端口，组网之前需要将组网所使用的端口开放出来。

以Azure为例，需要在虚拟机的网络管理页面新增入站连接规则将组网端口开放出来，组网端口默认为8060。

![alt text](6.png)

3. 局域网防火墙出站规则可能也限制了非http服务的端口，局域网中的服务器向公网发送目标端口为8060的tcp连接可能会被局域网本地的防火墙拦截，所以组网之前需要先向局域网的管理员确认组网用到的端口是否被屏蔽，如果被屏蔽可以申请开放组网端口或者修改云端节点的组网端口。



