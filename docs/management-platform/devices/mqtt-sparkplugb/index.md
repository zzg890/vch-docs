# MQTT SparkplugB

WAGO VC Hub中的MQTT SparkplugB驱动程序基于MQTT协议设计和开发，支持满足SparkplugB协议的报文信息传输。同时系统自带一个MQTT Broker，支持用户通过系统提供的账户和密码连接，并通过MQTT SparkplugB驱动进行数据通信。

#### 驱动连接到MQTT Broker

1. 在”**设备**“->”**MQTT SparkplugB**“页面，点击“**新增组**”按钮。

**组**：组是用于组织设备的一种方式，通过将设备组织成组，可以更方便地进行管理和操作。

2. 在新增页面中输入**组名称**。

![alt text](1.png)

3. 点击**“确认”**按钮。此时该条数据将显示在MQTT SparkplugB的设备列表页面。

![alt text](2.png)

4. 在操作一栏中点击“**添加节点**”，输入节点名称，为当前组添加一个新的节点。

**节点**：节点代表具体设备的实体，具有唯一标识符，用于区分各个设备。

![alt text](3.png)

5. 点击**“确认”**按钮。此时该条数据将显示在当前组的节点列表页面。

![alt text](4.png)

6. 在启用状态一栏点击启用按钮，启用该节点。

![alt text](5.png)

###### 配置字段

| **名称** | **描述**                                               |
|----------|--------------------------------------------------------|
| 组名称   | 驱动的组名称，在驱动列表中唯一。                         |
| 节点名称 | 组的某个节点名称，在组中唯一。                           |
| 用户名   | 用于与某边缘节点(EoN)连接的账号，系统自动生成，不可修改。 |
| 密码     | 用于与某边缘节点(EoN)连接的密码，系统自动生成，支持重置。 |

#### 注意事项

1. 节点列表中，**启用状态**表示设备是否已被启用，未启用的设备不会进行连接，启用的设备会尝试进行连接；**连接状态**表示设备是否已成功与系统建立通信连接。
2. **全部启用**和**全部禁用**，是对列表中的所有数据进行启用或禁用。
3. 请妥善保管用户名和密码信息，避免泄露给未授权人员，如果发生泄露，请及时重置密码。

系统目前支持的数据类型：

| **类型** | **说明**       |
|----------|----------------|
| Int8     | 8位有符号整数  |
| Int16    | 16位有符号整数 |
| Int32    | 32位有符号整数 |
| Int64    | 64位有符号整数 |
| UInt8    | 8位无符号整数  |
| UInt16   | 16位无符号整数 |
| UInt32   | 32位无符号整数 |
| UInt64   | 64位无符号整数 |
| Float    | 单精度浮点数   |
| Double   | 双精度浮点数   |
| Boolean  | 布尔值         |
| String   | 字符串         |
| Text     | 文本；同字符串  |
| DateTime | 日期           |

#### 连接到系统MQTT Broker

在使用 MQTT SparkplugB 驱动程序之前，您需要先连接到系统的 Sparkplug Application。请按照以下步骤进行连接：

1. 获取账户和密码：点击节点的**“查看”**按钮，可以看到系统提供的用户名和密码。
2. 配置客户端：在您的应用程序或设备中，配置边缘节点(SparkplugB Node)以连接到系统的Sparkplug Application：

   - Broker 地址：填写系统 MQTT Broker 的地址。
   - Broker 端口：填写系统 MQTT Broker 的端口号。默认为 1884。
   - 客户端 ID：填写一个唯一的客户端标识符，用于在系统 MQTT Broker 上标识您的连接。
   - 用户名和密码：使用您在系统中获取到的账户和密码。
   - VC HubHostIdentifier：WagoVC Hub
   - GroupName：对应驱动列表中的组名称
   - NodeName：对应驱动列表组中的节点名称
3. 连接到 MQTT Broker：使用支持SparkplguB协议的MQTT客户端，在应用程序或设备中连接到系统的 MQTT Broker。确认连接成功后，便可以开始使用客户端与MQTT SparkplugB驱动程序进行设备数据的传输。
4. 消息传输遵循SparkplugB协议，更多信息请参考官方文档 [https://www.eclipse.org/tahu/spec/sparkplug_spec.pdf](https://www.eclipse.org/tahu/spec/sparkplug_spec.pdf)。 

#### 与变量绑定

将变量与客户端测点进行绑定。

1. 创建一个I/O变量。

![alt text](6.png)

2. 在变量的编辑界面，点击数据源的**设置**按钮。

![alt text](7.png)

3. 选择需要绑定的组、节点、设备和目录，并勾选数据类型匹配的测点。

![alt text](8.png)

4. 点击“**确认**”按钮，完成配置。

